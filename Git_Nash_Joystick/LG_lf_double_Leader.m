function [ sys,sysd ] = LG_lf_double_Leader(dt)
%%
% Parameters:
% Quadcopter Parameters:
mQ1 = 0.55;
mQ2 = 0.55;
g = 9.8;

Ix1=0.0023;
Iy1=0.0028;
Iz1=0.0046;
Ix2=0.0023;
Iy2=0.0028;
Iz2=0.0046;

% Payload parameters:
mP = 0.2;
Lr = 1 ;
%%
xQ1 = 0; dxQ1 = 0;
yQ1 = 0; dyQ1 = 0;
zQ1 = 0; dzQ1 = 0;

phi1 = 0; dphi1 =0;
theta1 = 0.1526; dtheta1 = 0;
psi1 = 0; dpsi1 = 0;

alpha1 = deg2rad(0); dalpha1 = 0;
beta1 = deg2rad(45); dbeta1 = 0;

alpha2 = deg2rad(180); dalpha2 = 0;
beta2 = deg2rad(45); dbeta2 = 0;

phi2 = 0; dphi2 = 0;
theta2 = -0.1526; dtheta2 = 0;
psi2 = 0; dpsi2 = 0;

Fz1=6.4449; Mx1=0; My1=0; Mz1=0;
Fz2=6.4449; Mx2=0; My2=0; Mz2=0;
%%
M = [mP+mQ1+mQ2,0,0,0,0,0,Lr.*(mP+mQ2).*cos(beta1).*sin(alpha1),Lr.*( ...
  mP+mQ2).*cos(alpha1).*sin(beta1),(-1).*Lr.*mQ2.*cos(beta2).*sin( ...
  alpha2),(-1).*Lr.*mQ2.*cos(alpha2).*sin(beta2),0,0,0;0,mP+mQ1+mQ2, ...
  0,0,0,0,(-1).*Lr.*(mP+mQ2).*cos(alpha1).*cos(beta1),Lr.*(mP+mQ2).* ...
  sin(alpha1).*sin(beta1),Lr.*mQ2.*cos(alpha2).*cos(beta2),(-1).* ...
  Lr.*mQ2.*sin(alpha2).*sin(beta2),0,0,0;0,0,mP+mQ1+mQ2,0,0,0,0,(-1) ...
  .*Lr.*(mP+mQ2).*cos(beta1),0,Lr.*mQ2.*cos(beta2),0,0,0;0,0,0,Ix1, ...
  0,(-1).*Ix1.*sin(theta1),0,0,0,0,0,0,0;0,0,0,0,Iy1.*cos(phi1).^2+ ...
  Iz1.*sin(phi1).^2,(Iy1+(-1).*Iz1).*cos(phi1).*cos(theta1).*sin( ...
  phi1),0,0,0,0,0,0,0;0,0,0,(-1).*Ix1.*sin(theta1),(Iy1+(-1).*Iz1).* ...
  cos(phi1).*cos(theta1).*sin(phi1),cos(theta1).^2.*(Iz1.*cos(phi1) ...
  .^2+Iy1.*sin(phi1).^2)+Ix1.*sin(theta1).^2,0,0,0,0,0,0,0;Lr.*(mP+ ...
  mQ2).*cos(beta1).*sin(alpha1),(-1).*Lr.*(mP+mQ2).*cos(alpha1).* ...
  cos(beta1),0,0,0,0,Lr.^2.*(mP+mQ2).*cos(beta1).^2,0,(-1).*Lr.^2.* ...
  mQ2.*cos(alpha1+(-1).*alpha2).*cos(beta1).*cos(beta2),(-1).* ...
  Lr.^2.*mQ2.*cos(beta1).*sin(alpha1+(-1).*alpha2).*sin(beta2),0,0, ...
  0;Lr.*(mP+mQ2).*cos(alpha1).*sin(beta1),Lr.*(mP+mQ2).*sin(alpha1) ...
  .*sin(beta1),(-1).*Lr.*(mP+mQ2).*cos(beta1),0,0,0,0,Lr.^2.*(mP+ ...
  mQ2),Lr.^2.*mQ2.*cos(beta2).*sin(alpha1+(-1).*alpha2).*sin(beta1), ...
  (-1).*Lr.^2.*mQ2.*(cos(beta1).*cos(beta2)+cos(alpha1+(-1).*alpha2) ...
  .*sin(beta1).*sin(beta2)),0,0,0;(-1).*Lr.*mQ2.*cos(beta2).*sin( ...
  alpha2),Lr.*mQ2.*cos(alpha2).*cos(beta2),0,0,0,0,(-1).*Lr.^2.* ...
  mQ2.*cos(alpha1+(-1).*alpha2).*cos(beta1).*cos(beta2),Lr.^2.*mQ2.* ...
  cos(beta2).*sin(alpha1+(-1).*alpha2).*sin(beta1),Lr.^2.*mQ2.*cos( ...
  beta2).^2,0,0,0,0;(-1).*Lr.*mQ2.*cos(alpha2).*sin(beta2),(-1).* ...
  Lr.*mQ2.*sin(alpha2).*sin(beta2),Lr.*mQ2.*cos(beta2),0,0,0,(-1).* ...
  Lr.^2.*mQ2.*cos(beta1).*sin(alpha1+(-1).*alpha2).*sin(beta2),(-1) ...
  .*Lr.^2.*mQ2.*(cos(beta1).*cos(beta2)+cos(alpha1+(-1).*alpha2).* ...
  sin(beta1).*sin(beta2)),0,Lr.^2.*mQ2,0,0,0;0,0,0,0,0,0,0,0,0,0, ...
  Ix2,0,(-1).*Ix2.*sin(theta2);0,0,0,0,0,0,0,0,0,0,0,Iy2.*cos(phi2) ...
  .^2+Iz2.*sin(phi2).^2,(Iy2+(-1).*Iz2).*cos(phi2).*cos(theta2).* ...
  sin(phi2);0,0,0,0,0,0,0,0,0,0,(-1).*Ix2.*sin(theta2),(Iy2+(-1).* ...
  Iz2).*cos(phi2).*cos(theta2).*sin(phi2),cos(theta2).^2.*(Iz2.*cos( ...
  phi2).^2+Iy2.*sin(phi2).^2)+Ix2.*sin(theta2).^2];

DfxuDX1 = [0,0,0,0,0,0,Fz1.*(cos(phi1).*sin(psi1)+(-1).*cos(psi1).*sin(phi1) ...
  .*sin(theta1)),0,Fz1.*cos(phi1).*cos(psi1).*cos(theta1),0,Fz1.*( ...
  cos(psi1).*sin(phi1)+(-1).*cos(phi1).*sin(psi1).*sin(theta1)),0, ...
  Lr.*(mP+mQ2).*((dalpha1.^2+dbeta1.^2).*cos(beta1).*sin(alpha1)+2.* ...
  dalpha1.*dbeta1.*cos(alpha1).*sin(beta1)),(-2).*Lr.*(mP+mQ2).*( ...
  dalpha1.*cos(alpha1).*cos(beta1)+(-1).*dbeta1.*sin(alpha1).*sin( ...
  beta1)),Lr.*(mP+mQ2).*(2.*dalpha1.*dbeta1.*cos(beta1).*sin(alpha1) ...
  +(dalpha1.^2+dbeta1.^2).*cos(alpha1).*sin(beta1)),(-2).*Lr.*(mP+ ...
  mQ2).*(dbeta1.*cos(alpha1).*cos(beta1)+(-1).*dalpha1.*sin(alpha1) ...
  .*sin(beta1)),(-1).*Lr.*mQ2.*((dalpha2.^2+dbeta2.^2).*cos(beta2).* ...
  sin(alpha2)+2.*dalpha2.*dbeta2.*cos(alpha2).*sin(beta2)),2.*Lr.* ...
  mQ2.*(dalpha2.*cos(alpha2).*cos(beta2)+(-1).*dbeta2.*sin(alpha2).* ...
  sin(beta2)),(-1).*Lr.*mQ2.*(2.*dalpha2.*dbeta2.*cos(beta2).*sin( ...
  alpha2)+(dalpha2.^2+dbeta2.^2).*cos(alpha2).*sin(beta2)),2.*Lr.* ...
  mQ2.*(dbeta2.*cos(alpha2).*cos(beta2)+(-1).*dalpha2.*sin(alpha2).* ...
  sin(beta2)),Fz2.*(cos(phi2).*sin(psi2)+(-1).*cos(psi2).*sin(phi2) ...
  .*sin(theta2)),0,Fz2.*cos(phi2).*cos(psi2).*cos(theta2),0,Fz2.*( ...
  cos(psi2).*sin(phi2)+(-1).*cos(phi2).*sin(psi2).*sin(theta2)),0];

DfxuDX2 = [0,0,0,0,0,0,(-1).*Fz1.*(cos(phi1).*cos(psi1)+sin(phi1).*sin(psi1) ...
  .*sin(theta1)),0,Fz1.*cos(phi1).*cos(theta1).*sin(psi1),0,Fz1.*( ...
  sin(phi1).*sin(psi1)+cos(phi1).*cos(psi1).*sin(theta1)),0,(-1).* ...
  Lr.*(mP+mQ2).*((dalpha1.^2+dbeta1.^2).*cos(alpha1).*cos(beta1)+( ...
  -2).*dalpha1.*dbeta1.*sin(alpha1).*sin(beta1)),(-2).*Lr.*(mP+mQ2) ...
  .*(dalpha1.*cos(beta1).*sin(alpha1)+dbeta1.*cos(alpha1).*sin( ...
  beta1)),Lr.*(mP+mQ2).*((-2).*dalpha1.*dbeta1.*cos(alpha1).*cos( ...
  beta1)+(dalpha1.^2+dbeta1.^2).*sin(alpha1).*sin(beta1)),(-2).*Lr.* ...
  (mP+mQ2).*(dbeta1.*cos(beta1).*sin(alpha1)+dalpha1.*cos(alpha1).* ...
  sin(beta1)),Lr.*mQ2.*((dalpha2.^2+dbeta2.^2).*cos(alpha2).*cos( ...
  beta2)+(-2).*dalpha2.*dbeta2.*sin(alpha2).*sin(beta2)),2.*Lr.* ...
  mQ2.*(dalpha2.*cos(beta2).*sin(alpha2)+dbeta2.*cos(alpha2).*sin( ...
  beta2)),(-1).*Lr.*mQ2.*((-2).*dalpha2.*dbeta2.*cos(alpha2).*cos( ...
  beta2)+(dalpha2.^2+dbeta2.^2).*sin(alpha2).*sin(beta2)),2.*Lr.* ...
  mQ2.*(dbeta2.*cos(beta2).*sin(alpha2)+dalpha2.*cos(alpha2).*sin( ...
  beta2)),(-1).*Fz2.*(cos(phi2).*cos(psi2)+sin(phi2).*sin(psi2).* ...
  sin(theta2)),0,Fz2.*cos(phi2).*cos(theta2).*sin(psi2),0,Fz2.*(sin( ...
  phi2).*sin(psi2)+cos(phi2).*cos(psi2).*sin(theta2)),0];

DfxuDX3 = [0,0,0,0,0,0,(-1).*Fz1.*cos(theta1).*sin(phi1),0,(-1).*Fz1.*cos( ...
  phi1).*sin(theta1),0,0,0,0,0,(-1).*dbeta1.^2.*Lr.*(mP+mQ2).*cos( ...
  beta1),(-2).*dbeta1.*Lr.*(mP+mQ2).*sin(beta1),0,0,dbeta2.^2.*Lr.* ...
  mQ2.*cos(beta2),2.*dbeta2.*Lr.*mQ2.*sin(beta2),(-1).*Fz2.*cos( ...
  theta2).*sin(phi2),0,(-1).*Fz2.*cos(phi2).*sin(theta2),0,0,0];

DfxuDX4 = [0,0,0,0,0,0,(1/2).*(Iy1+(-1).*Iz1).*(cos(2.*phi1).*(dpsi1.^2+(-2) ...
  .*dtheta1.^2+dpsi1.^2.*cos(2.*theta1))+(-4).*dpsi1.*dtheta1.*cos( ...
  theta1).*sin(2.*phi1)),0,dpsi1.*((-1).*dtheta1.*Ix1+(-1).*(Iy1+( ...
  -1).*Iz1).*(dtheta1.*cos(2.*phi1)+dpsi1.*cos(theta1).*sin(2.*phi1) ...
  )).*sin(theta1),dpsi1.*(Ix1+(Iy1+(-1).*Iz1).*cos(2.*phi1)).*cos( ...
  theta1)+dtheta1.*((-1).*Iy1+Iz1).*sin(2.*phi1),0,cos(theta1).*( ...
  dtheta1.*Ix1+(Iy1+(-1).*Iz1).*(dtheta1.*cos(2.*phi1)+dpsi1.*cos( ...
  theta1).*sin(2.*phi1))),0,0,0,0,0,0,0,0,0,0,0,0,0,0];

DfxuDX5 = [0,0,0,0,0,0,(-1).*My1.*sin(phi1)+2.*dphi1.*(Iy1+(-1).*Iz1).*( ...
  dtheta1.*cos(2.*phi1)+dpsi1.*cos(theta1).*sin(2.*phi1))+cos(phi1) ...
  .*((-1).*Mz1+dpsi1.^2.*((-1).*Iy1+Iz1).*sin(phi1).*sin(2.*theta1)) ...
  ,(-1).*dpsi1.*(Ix1+(Iy1+(-1).*Iz1).*cos(2.*phi1)).*cos(theta1)+ ...
  dtheta1.*(Iy1+(-1).*Iz1).*sin(2.*phi1),(1/2).*dpsi1.*(dpsi1.*(2.* ...
  Ix1+(-1).*Iy1+(-1).*Iz1+(Iy1+(-1).*Iz1).*cos(2.*phi1)).*cos(2.* ...
  theta1)+2.*dphi1.*(Ix1+(Iy1+(-1).*Iz1).*cos(2.*phi1)).*sin(theta1) ...
  ),dphi1.*(Iy1+(-1).*Iz1).*sin(2.*phi1),0,cos(theta1).*((-1).* ...
  dphi1.*Ix1+dpsi1.*(2.*Ix1+(-1).*Iy1+(-1).*Iz1).*sin(theta1)+(-1).* ...
  (Iy1+(-1).*Iz1).*cos(2.*phi1).*(dphi1+(-1).*dpsi1.*sin(theta1))), ...
  0,0,0,0,0,0,0,0,0,0,0,0,0,0];

DfxuDX6 = [0,0,0,0,0,0,My1.*cos(phi1).*cos(theta1)+(-1).*(Iy1+(-1).*Iz1).* ...
  cos(2.*phi1).*(2.*dphi1.*dpsi1.*cos(theta1).^2+(-1).*dtheta1.^2.* ...
  sin(theta1))+cos(theta1).*((-1).*Mz1.*sin(phi1)+2.*dtheta1.*(Iy1+( ...
  -1).*Iz1).*sin(2.*phi1).*(dphi1+dpsi1.*sin(theta1))),cos(theta1).* ...
  (dtheta1.*Ix1+(-1).*(Iy1+(-1).*Iz1).*(dtheta1.*cos(2.*phi1)+ ...
  dpsi1.*cos(theta1).*sin(2.*phi1))),dpsi1.*dtheta1.*((-2).*Ix1+Iy1+ ...
  Iz1+((-1).*Iy1+Iz1).*cos(2.*phi1)).*cos(2.*theta1)+(-1).*(Mz1.* ...
  cos(phi1)+dphi1.*dtheta1.*(Ix1+((-1).*Iy1+Iz1).*cos(2.*phi1))+ ...
  My1.*sin(phi1)).*sin(theta1)+cos(theta1).*((-1).*Mx1+(Iy1+(-1).* ...
  Iz1).*cos(phi1).*sin(phi1).*(dtheta1.^2+4.*dphi1.*dpsi1.*sin( ...
  theta1))),dphi1.*(Ix1+((-1).*Iy1+Iz1).*cos(2.*phi1)).*cos(theta1)+ ...
  dtheta1.*(Iy1+(-1).*Iz1).*sin(2.*phi1).*sin(theta1)+(1/2).*dpsi1.* ...
  ((-2).*Ix1+Iy1+Iz1+((-1).*Iy1+Iz1).*cos(2.*phi1)).*sin(2.*theta1), ...
  0,2.*cos(theta1).*(dphi1.*((-1).*Iy1+Iz1).*cos(phi1).*cos(theta1) ...
  .*sin(phi1)+dtheta1.*((-1).*Ix1+Iz1.*cos(phi1).^2+Iy1.*sin(phi1) ...
  .^2).*sin(theta1)),0,0,0,0,0,0,0,0,0,0,0,0,0,0];

DfxuDX7 = [0,0,0,0,0,0,0,0,0,0,0,0,Lr.*cos(beta1).*(cos(alpha1).*(( ...
  dalpha2.^2+dbeta2.^2).*Lr.*mQ2.*cos(alpha2).*cos(beta2)+(-2).* ...
  dalpha2.*dbeta2.*Lr.*mQ2.*sin(alpha2).*sin(beta2)+Fz2.*sin(phi2).* ...
  sin(psi2)+Fz2.*cos(phi2).*cos(psi2).*sin(theta2))+sin(alpha1).*(( ...
  dalpha2.^2+dbeta2.^2).*Lr.*mQ2.*cos(beta2).*sin(alpha2)+2.* ...
  dalpha2.*dbeta2.*Lr.*mQ2.*cos(alpha2).*sin(beta2)+(-1).*Fz2.*cos( ...
  psi2).*sin(phi2)+Fz2.*cos(phi2).*sin(psi2).*sin(theta2))),dbeta1.* ...
  Lr.^2.*(mP+mQ2).*sin(2.*beta1),Lr.*(2.*dalpha1.*dbeta1.*Lr.*(mP+ ...
  mQ2).*cos(beta1).^2+(-1).*sin(beta1).*(2.*dalpha1.*dbeta1.*Lr.* ...
  mP.*sin(beta1)+2.*dalpha1.*dbeta1.*Lr.*mQ2.*sin(beta1)+(-2).* ...
  dalpha2.*dbeta2.*Lr.*mQ2.*sin(alpha1).*sin(alpha2).*sin(beta2)+ ...
  Lr.*mQ2.*cos(alpha2).*((dalpha2.^2+dbeta2.^2).*cos(beta2).*sin( ...
  alpha1)+(-2).*dalpha2.*dbeta2.*cos(alpha1).*sin(beta2))+cos( ...
  alpha1).*((-1).*(dalpha2.^2+dbeta2.^2).*Lr.*mQ2.*cos(beta2).*sin( ...
  alpha2)+Fz2.*cos(psi2).*sin(phi2))+Fz2.*sin(alpha1).*sin(phi2).* ...
  sin(psi2)+Fz2.*cos(phi2).*sin(alpha1+(-1).*psi2).*sin(theta2))), ...
  dalpha1.*Lr.^2.*(mP+mQ2).*sin(2.*beta1),Lr.^2.*mQ2.*cos(beta1).*(( ...
  -1).*(dalpha2.^2+dbeta2.^2).*cos(alpha1+(-1).*alpha2).*cos(beta2)+ ...
  (-2).*dalpha2.*dbeta2.*sin(alpha1+(-1).*alpha2).*sin(beta2)),2.* ...
  Lr.^2.*mQ2.*cos(beta1).*(dalpha2.*cos(beta2).*sin(alpha1+(-1).* ...
  alpha2)+(-1).*dbeta2.*cos(alpha1+(-1).*alpha2).*sin(beta2)), ...
  Lr.^2.*mQ2.*cos(beta1).*((-2).*dalpha2.*dbeta2.*cos(alpha1+(-1).* ...
  alpha2).*cos(beta2)+(-1).*(dalpha2.^2+dbeta2.^2).*sin(alpha1+(-1) ...
  .*alpha2).*sin(beta2)),(-2).*Lr.^2.*mQ2.*cos(beta1).*(cos(alpha2) ...
  .*((-1).*dbeta2.*cos(beta2).*sin(alpha1)+dalpha2.*cos(alpha1).* ...
  sin(beta2))+sin(alpha2).*(dbeta2.*cos(alpha1).*cos(beta2)+ ...
  dalpha2.*sin(alpha1).*sin(beta2))),Fz2.*Lr.*cos(beta1).*(cos(phi2) ...
  .*cos(alpha1+(-1).*psi2)+(-1).*sin(phi2).*sin(alpha1+(-1).*psi2).* ...
  sin(theta2)),0,Fz2.*Lr.*cos(beta1).*cos(phi2).*cos(theta2).*sin( ...
  alpha1+(-1).*psi2),0,Fz2.*Lr.*cos(beta1).*(sin(phi2).*sin(alpha1+( ...
  -1).*psi2)+(-1).*cos(phi2).*cos(alpha1+(-1).*psi2).*sin(theta2)), ...
  0];

DfxuDX8 = [0,0,0,0,0,0,0,0,0,0,0,0,(-1).*Lr.*sin(beta1).*((-2).*dalpha2.* ...
  dbeta2.*Lr.*mQ2.*sin(alpha1).*sin(alpha2).*sin(beta2)+Lr.*mQ2.* ...
  cos(alpha2).*((dalpha2.^2+dbeta2.^2).*cos(beta2).*sin(alpha1)+(-2) ...
  .*dalpha2.*dbeta2.*cos(alpha1).*sin(beta2))+cos(alpha1).*((-1).*( ...
  dalpha2.^2+dbeta2.^2).*Lr.*mQ2.*cos(beta2).*sin(alpha2)+Fz2.*cos( ...
  psi2).*sin(phi2))+Fz2.*sin(alpha1).*sin(phi2).*sin(psi2)+Fz2.*cos( ...
  phi2).*sin(alpha1+(-1).*psi2).*sin(theta2)),(-1).*dalpha1.*Lr.^2.* ...
  (mP+mQ2).*sin(2.*beta1),Lr.*((-1).*dalpha1.^2.*Lr.*(mP+mQ2).*cos( ...
  beta1).^2+sin(beta1).*(Fz2.*cos(phi2).*cos(theta2)+(mP+mQ2).*((-1) ...
  .*g+dalpha1.^2.*Lr.*sin(beta1))+dbeta2.^2.*Lr.*mQ2.*sin(beta2))+ ...
  cos(beta1).*(sin(alpha1).*(Lr.*mQ2.*((dalpha2.^2+dbeta2.^2).*cos( ...
  beta2).*sin(alpha2)+2.*dalpha2.*dbeta2.*cos(alpha2).*sin(beta2))+( ...
  -1).*Fz2.*cos(psi2).*sin(phi2))+cos(alpha1).*(Lr.*mQ2.*(( ...
  dalpha2.^2+dbeta2.^2).*cos(alpha2).*cos(beta2)+(-2).*dalpha2.* ...
  dbeta2.*sin(alpha2).*sin(beta2))+Fz2.*sin(phi2).*sin(psi2))+Fz2.* ...
  cos(phi2).*cos(alpha1+(-1).*psi2).*sin(theta2))),0,Lr.^2.*mQ2.* ...
  sin(beta1).*((dalpha2.^2+dbeta2.^2).*cos(beta2).*sin(alpha1+(-1).* ...
  alpha2)+(-2).*dalpha2.*dbeta2.*cos(alpha1+(-1).*alpha2).*sin( ...
  beta2)),2.*Lr.^2.*mQ2.*sin(beta1).*(dalpha2.*cos(alpha1+(-1).* ...
  alpha2).*cos(beta2)+dbeta2.*sin(alpha1+(-1).*alpha2).*sin(beta2)), ...
  Lr.^2.*mQ2.*(dbeta2.*cos(beta2).*((-1).*dbeta2.*cos(beta1)+2.* ...
  dalpha2.*sin(alpha1+(-1).*alpha2).*sin(beta1))+(-1).*(dalpha2.^2+ ...
  dbeta2.^2).*cos(alpha1+(-1).*alpha2).*sin(beta1).*sin(beta2)),2.* ...
  Lr.^2.*mQ2.*(dbeta2.*cos(alpha1+(-1).*alpha2).*cos(beta2).*sin( ...
  beta1)+((-1).*dbeta2.*cos(beta1)+dalpha2.*sin(alpha1+(-1).*alpha2) ...
  .*sin(beta1)).*sin(beta2)),Fz2.*Lr.*(cos(beta1).*cos(theta2).*sin( ...
  phi2)+(-1).*sin(beta1).*(cos(phi2).*sin(alpha1+(-1).*psi2)+cos( ...
  alpha1+(-1).*psi2).*sin(phi2).*sin(theta2))),0,Fz2.*Lr.*cos(phi2) ...
  .*(cos(alpha1+(-1).*psi2).*cos(theta2).*sin(beta1)+cos(beta1).* ...
  sin(theta2)),0,Fz2.*Lr.*sin(beta1).*(cos(alpha1+(-1).*psi2).*sin( ...
  phi2)+cos(phi2).*sin(alpha1+(-1).*psi2).*sin(theta2)),0];

DfxuDX9 = [0,0,0,0,0,0,0,0,0,0,0,0,Lr.^2.*mQ2.*cos(beta2).*((-1).*( ...
  dalpha1.^2+dbeta1.^2).*cos(alpha1+(-1).*alpha2).*cos(beta1)+2.* ...
  dalpha1.*dbeta1.*sin(alpha1+(-1).*alpha2).*sin(beta1)),(-2).* ...
  Lr.^2.*mQ2.*cos(beta2).*(dalpha1.*cos(beta1).*sin(alpha1+(-1).* ...
  alpha2)+dbeta1.*cos(alpha1+(-1).*alpha2).*sin(beta1)),Lr.^2.*mQ2.* ...
  cos(beta2).*((-2).*dalpha1.*dbeta1.*cos(alpha1+(-1).*alpha2).*cos( ...
  beta1)+(dalpha1.^2+dbeta1.^2).*sin(alpha1+(-1).*alpha2).*sin( ...
  beta1)),(-2).*Lr.^2.*mQ2.*cos(beta2).*(dbeta1.*cos(beta1).*sin( ...
  alpha1+(-1).*alpha2)+dalpha1.*cos(alpha1+(-1).*alpha2).*sin(beta1) ...
  ),Lr.*cos(beta2).*((dalpha1.^2+dbeta1.^2).*Lr.*mQ2.*cos(beta1).* ...
  sin(alpha1).*sin(alpha2)+Lr.*mQ2.*cos(alpha1).*((dalpha1.^2+ ...
  dbeta1.^2).*cos(alpha2).*cos(beta1)+2.*dalpha1.*dbeta1.*sin( ...
  alpha2).*sin(beta1))+Fz2.*cos(psi2).*sin(alpha2).*sin(phi2)+(-1).* ...
  cos(alpha2).*(2.*dalpha1.*dbeta1.*Lr.*mQ2.*sin(alpha1).*sin(beta1) ...
  +Fz2.*sin(phi2).*sin(psi2))+(-1).*Fz2.*cos(phi2).*cos(alpha2+(-1) ...
  .*psi2).*sin(theta2)),dbeta2.*Lr.^2.*mQ2.*sin(2.*beta2),Lr.*(2.* ...
  dalpha2.*dbeta2.*Lr.*mQ2.*cos(beta2).^2+sin(beta2).*((-1).*( ...
  dalpha1.^2+dbeta1.^2).*Lr.*mQ2.*cos(alpha1).*cos(beta1).*sin( ...
  alpha2)+2.*dalpha1.*dbeta1.*Lr.*mQ2.*sin(alpha1).*sin(alpha2).* ...
  sin(beta1)+(-2).*dalpha2.*dbeta2.*Lr.*mQ2.*sin(beta2)+Fz2.*sin( ...
  alpha2).*sin(phi2).*sin(psi2)+Fz2.*cos(phi2).*cos(psi2).*sin( ...
  alpha2).*sin(theta2)+cos(alpha2).*((dalpha1.^2+dbeta1.^2).*Lr.* ...
  mQ2.*cos(beta1).*sin(alpha1)+2.*dalpha1.*dbeta1.*Lr.*mQ2.*cos( ...
  alpha1).*sin(beta1)+Fz2.*cos(psi2).*sin(phi2)+(-1).*Fz2.*cos(phi2) ...
  .*sin(psi2).*sin(theta2)))),dalpha2.*Lr.^2.*mQ2.*sin(2.*beta2), ...
  Fz2.*Lr.*cos(beta2).*((-1).*cos(phi2).*cos(alpha2+(-1).*psi2)+sin( ...
  phi2).*sin(alpha2+(-1).*psi2).*sin(theta2)),0,(-1).*Fz2.*Lr.*cos( ...
  beta2).*cos(phi2).*cos(theta2).*sin(alpha2+(-1).*psi2),0,Fz2.*Lr.* ...
  cos(beta2).*((-1).*sin(phi2).*sin(alpha2+(-1).*psi2)+cos(phi2).* ...
  cos(alpha2+(-1).*psi2).*sin(theta2)),0];

DfxuDX10 = [0,0,0,0,0,0,0,0,0,0,0,0,(-1).*Lr.^2.*mQ2.*((dalpha1.^2+dbeta1.^2) ...
  .*cos(beta1).*sin(alpha1+(-1).*alpha2)+2.*dalpha1.*dbeta1.*cos( ...
  alpha1+(-1).*alpha2).*sin(beta1)).*sin(beta2),2.*Lr.^2.*mQ2.*( ...
  dalpha1.*cos(alpha1+(-1).*alpha2).*cos(beta1)+(-1).*dbeta1.*sin( ...
  alpha1+(-1).*alpha2).*sin(beta1)).*sin(beta2),(-1).*Lr.^2.*mQ2.*(( ...
  dalpha1.^2+dbeta1.^2).*cos(alpha1+(-1).*alpha2).*sin(beta1).*sin( ...
  beta2)+dbeta1.*cos(beta1).*(dbeta1.*cos(beta2)+2.*dalpha1.*sin( ...
  alpha1+(-1).*alpha2).*sin(beta2))),(-2).*Lr.^2.*mQ2.*(dbeta1.*cos( ...
  beta2).*sin(beta1)+((-1).*dbeta1.*cos(alpha1+(-1).*alpha2).*cos( ...
  beta1)+dalpha1.*sin(alpha1+(-1).*alpha2).*sin(beta1)).*sin(beta2)) ...
  ,Lr.*sin(beta2).*(sin(alpha2).*((-1).*(dalpha1.^2+dbeta1.^2).*Lr.* ...
  mQ2.*cos(alpha1).*cos(beta1)+2.*dalpha1.*dbeta1.*Lr.*mQ2.*sin( ...
  alpha1).*sin(beta1)+Fz2.*sin(phi2).*sin(psi2)+Fz2.*cos(phi2).*cos( ...
  psi2).*sin(theta2))+cos(alpha2).*((dalpha1.^2+dbeta1.^2).*Lr.* ...
  mQ2.*cos(beta1).*sin(alpha1)+2.*dalpha1.*dbeta1.*Lr.*mQ2.*cos( ...
  alpha1).*sin(beta1)+Fz2.*cos(psi2).*sin(phi2)+(-1).*Fz2.*cos(phi2) ...
  .*sin(psi2).*sin(theta2))),(-1).*dalpha2.*Lr.^2.*mQ2.*sin(2.* ...
  beta2),Lr.*((-1).*dalpha2.^2.*Lr.*mQ2.*cos(beta2).^2+Lr.*mQ2.*cos( ...
  alpha1).*cos(beta2).*((dalpha1.^2+dbeta1.^2).*cos(alpha2).*cos( ...
  beta1)+2.*dalpha1.*dbeta1.*sin(alpha2).*sin(beta1))+sin(beta2).*(( ...
  -1).*Fz2.*cos(phi2).*cos(theta2)+mQ2.*(g+dbeta1.^2.*Lr.*sin(beta1) ...
  +dalpha2.^2.*Lr.*sin(beta2)))+cos(beta2).*((dalpha1.^2+dbeta1.^2) ...
  .*Lr.*mQ2.*cos(beta1).*sin(alpha1).*sin(alpha2)+Fz2.*cos(psi2).* ...
  sin(alpha2).*sin(phi2)+(-1).*cos(alpha2).*(2.*dalpha1.*dbeta1.* ...
  Lr.*mQ2.*sin(alpha1).*sin(beta1)+Fz2.*sin(phi2).*sin(psi2))+(-1).* ...
  Fz2.*cos(phi2).*cos(alpha2+(-1).*psi2).*sin(theta2))),0,Fz2.*Lr.*( ...
  (-1).*cos(beta2).*cos(theta2).*sin(phi2)+sin(beta2).*(cos(phi2).* ...
  sin(alpha2+(-1).*psi2)+cos(alpha2+(-1).*psi2).*sin(phi2).*sin( ...
  theta2))),0,(-1).*Fz2.*Lr.*cos(phi2).*(cos(alpha2+(-1).*psi2).* ...
  cos(theta2).*sin(beta2)+cos(beta2).*sin(theta2)),0,(-1).*Fz2.*Lr.* ...
  sin(beta2).*(cos(alpha2+(-1).*psi2).*sin(phi2)+cos(phi2).*sin( ...
  alpha2+(-1).*psi2).*sin(theta2)),0];

DfxuDX11 = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(1/2).*(Iy2+(-1).*Iz2).*( ...
  cos(2.*phi2).*(dpsi2.^2+(-2).*dtheta2.^2+dpsi2.^2.*cos(2.*theta2)) ...
  +(-4).*dpsi2.*dtheta2.*cos(theta2).*sin(2.*phi2)),0,dpsi2.*((-1).* ...
  dtheta2.*Ix2+(-1).*(Iy2+(-1).*Iz2).*(dtheta2.*cos(2.*phi2)+dpsi2.* ...
  cos(theta2).*sin(2.*phi2))).*sin(theta2),dpsi2.*(Ix2+(Iy2+(-1).* ...
  Iz2).*cos(2.*phi2)).*cos(theta2)+dtheta2.*((-1).*Iy2+Iz2).*sin(2.* ...
  phi2),0,cos(theta2).*(dtheta2.*Ix2+(Iy2+(-1).*Iz2).*(dtheta2.*cos( ...
  2.*phi2)+dpsi2.*cos(theta2).*sin(2.*phi2)))];

DfxuDX12 = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(-1).*My2.*sin(phi2)+2.* ...
  dphi2.*(Iy2+(-1).*Iz2).*(dtheta2.*cos(2.*phi2)+dpsi2.*cos(theta2) ...
  .*sin(2.*phi2))+cos(phi2).*((-1).*Mz2+dpsi2.^2.*((-1).*Iy2+Iz2).* ...
  sin(phi2).*sin(2.*theta2)),(-1).*dpsi2.*(Ix2+(Iy2+(-1).*Iz2).*cos( ...
  2.*phi2)).*cos(theta2)+dtheta2.*(Iy2+(-1).*Iz2).*sin(2.*phi2),( ...
  1/2).*dpsi2.*(dpsi2.*(2.*Ix2+(-1).*Iy2+(-1).*Iz2+(Iy2+(-1).*Iz2).* ...
  cos(2.*phi2)).*cos(2.*theta2)+2.*dphi2.*(Ix2+(Iy2+(-1).*Iz2).*cos( ...
  2.*phi2)).*sin(theta2)),dphi2.*(Iy2+(-1).*Iz2).*sin(2.*phi2),0, ...
  cos(theta2).*((-1).*dphi2.*Ix2+dpsi2.*(2.*Ix2+(-1).*Iy2+(-1).*Iz2) ...
  .*sin(theta2)+(-1).*(Iy2+(-1).*Iz2).*cos(2.*phi2).*(dphi2+(-1).* ...
  dpsi2.*sin(theta2)))];

DfxuDX13 = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,My2.*cos(phi2).*cos( ...
  theta2)+(-1).*(Iy2+(-1).*Iz2).*cos(2.*phi2).*(2.*dphi2.*dpsi2.* ...
  cos(theta2).^2+(-1).*dtheta2.^2.*sin(theta2))+cos(theta2).*((-1).* ...
  Mz2.*sin(phi2)+2.*dtheta2.*(Iy2+(-1).*Iz2).*sin(2.*phi2).*(dphi2+ ...
  dpsi2.*sin(theta2))),cos(theta2).*(dtheta2.*Ix2+(-1).*(Iy2+(-1).* ...
  Iz2).*(dtheta2.*cos(2.*phi2)+dpsi2.*cos(theta2).*sin(2.*phi2))), ...
  dpsi2.*dtheta2.*((-2).*Ix2+Iy2+Iz2+((-1).*Iy2+Iz2).*cos(2.*phi2)) ...
  .*cos(2.*theta2)+(-1).*(Mz2.*cos(phi2)+dphi2.*dtheta2.*(Ix2+((-1) ...
  .*Iy2+Iz2).*cos(2.*phi2))+My2.*sin(phi2)).*sin(theta2)+cos(theta2) ...
  .*((-1).*Mx2+(Iy2+(-1).*Iz2).*cos(phi2).*sin(phi2).*(dtheta2.^2+ ...
  4.*dphi2.*dpsi2.*sin(theta2))),dphi2.*(Ix2+((-1).*Iy2+Iz2).*cos( ...
  2.*phi2)).*cos(theta2)+dtheta2.*(Iy2+(-1).*Iz2).*sin(2.*phi2).* ...
  sin(theta2)+(1/2).*dpsi2.*((-2).*Ix2+Iy2+Iz2+((-1).*Iy2+Iz2).*cos( ...
  2.*phi2)).*sin(2.*theta2),0,2.*cos(theta2).*(dphi2.*((-1).*Iy2+ ...
  Iz2).*cos(phi2).*cos(theta2).*sin(phi2)+dtheta2.*((-1).*Ix2+Iz2.* ...
  cos(phi2).^2+Iy2.*sin(phi2).^2).*sin(theta2))];

DfxuDU = [sin(phi1).*sin(psi1)+cos(phi1).*cos(psi1).*sin(theta1),0,0,0,sin( ...
  phi2).*sin(psi2)+cos(phi2).*cos(psi2).*sin(theta2),0,0,0;(-1).* ...
  cos(psi1).*sin(phi1)+cos(phi1).*sin(psi1).*sin(theta1),0,0,0,(-1) ...
  .*cos(psi2).*sin(phi2)+cos(phi2).*sin(psi2).*sin(theta2),0,0,0; ...
  cos(phi1).*cos(theta1),0,0,0,cos(phi2).*cos(theta2),0,0,0;0,1,0,0, ...
  0,0,0,0;0,0,cos(phi1),(-1).*sin(phi1),0,0,0,0;0,(-1).*sin(theta1), ...
  cos(theta1).*sin(phi1),cos(phi1).*cos(theta1),0,0,0,0;0,0,0,0,Lr.* ...
  cos(beta1).*(cos(alpha1+(-1).*psi2).*sin(phi2)+cos(phi2).*sin( ...
  alpha1+(-1).*psi2).*sin(theta2)),0,0,0;0,0,0,0,(-1).*Lr.*(cos( ...
  beta1).*cos(phi2).*cos(theta2)+sin(beta1).*(sin(phi2).*sin(alpha1+ ...
  (-1).*psi2)+(-1).*cos(phi2).*cos(alpha1+(-1).*psi2).*sin(theta2))) ...
  ,0,0,0;0,0,0,0,(-1).*Lr.*cos(beta2).*(cos(alpha2+(-1).*psi2).*sin( ...
  phi2)+cos(phi2).*sin(alpha2+(-1).*psi2).*sin(theta2)),0,0,0;0,0,0, ...
  0,Lr.*(cos(beta2).*cos(phi2).*cos(theta2)+sin(beta2).*(sin(phi2).* ...
  sin(alpha2+(-1).*psi2)+(-1).*cos(phi2).*cos(alpha2+(-1).*psi2).* ...
  sin(theta2))),0,0,0;0,0,0,0,0,1,0,0;0,0,0,0,0,0,cos(phi2),(-1).* ...
  sin(phi2);0,0,0,0,0,(-1).*sin(theta2),cos(theta2).*sin(phi2),cos( ...
  phi2).*cos(theta2)];

DfxuDU1 = [sin(phi1).*sin(psi1)+cos(phi1).*cos(psi1).*sin(theta1),0,0,0;(-1) ...
  .*cos(psi1).*sin(phi1)+cos(phi1).*sin(psi1).*sin(theta1),0,0,0; ...
  cos(phi1).*cos(theta1),0,0,0;0,1,0,0;0,0,cos(phi1),(-1).*sin(phi1) ...
  ;0,(-1).*sin(theta1),cos(theta1).*sin(phi1),cos(phi1).*cos(theta1) ...
  ;0,0,0,0;0,0,0,0;0,0,0,0;0,0,0,0;0,0,0,0;0,0,0,0;0,0,0,0];

DfxuDU2 = [sin(phi2).*sin(psi2)+cos(phi2).*cos(psi2).*sin(theta2),0,0,0;(-1) ...
  .*cos(psi2).*sin(phi2)+cos(phi2).*sin(psi2).*sin(theta2),0,0,0; ...
  cos(phi2).*cos(theta2),0,0,0;0,0,0,0;0,0,0,0;0,0,0,0;Lr.*cos( ...
  beta1).*(cos(alpha1+(-1).*psi2).*sin(phi2)+cos(phi2).*sin(alpha1+( ...
  -1).*psi2).*sin(theta2)),0,0,0;(-1).*Lr.*(cos(beta1).*cos(phi2).* ...
  cos(theta2)+sin(beta1).*(sin(phi2).*sin(alpha1+(-1).*psi2)+(-1).* ...
  cos(phi2).*cos(alpha1+(-1).*psi2).*sin(theta2))),0,0,0;(-1).*Lr.* ...
  cos(beta2).*(cos(alpha2+(-1).*psi2).*sin(phi2)+cos(phi2).*sin( ...
  alpha2+(-1).*psi2).*sin(theta2)),0,0,0;Lr.*(cos(beta2).*cos(phi2) ...
  .*cos(theta2)+sin(beta2).*(sin(phi2).*sin(alpha2+(-1).*psi2)+(-1) ...
  .*cos(phi2).*cos(alpha2+(-1).*psi2).*sin(theta2))),0,0,0;0,1,0,0; ...
  0,0,cos(phi2),(-1).*sin(phi2);0,(-1).*sin(theta2),cos(theta2).* ...
  sin(phi2),cos(phi2).*cos(theta2)];
%%
dummy = M\[DfxuDX1;DfxuDX2;DfxuDX3;DfxuDX4;DfxuDX5;...
    DfxuDX6;DfxuDX7;DfxuDX8;DfxuDX9;DfxuDX10;...
    DfxuDX11;DfxuDX12;DfxuDX13;];
A = [zeros(1,1),1,zeros(1,24);...
    dummy(1,:);...
    zeros(1,3),1,zeros(1,22);...
    dummy(2,:);...
    zeros(1,5),1,zeros(1,20);...
    dummy(3,:);...
    zeros(1,7),1,zeros(1,18);...
    dummy(4,:);...
    zeros(1,9),1,zeros(1,16);...
    dummy(5,:);...
    zeros(1,11),1,zeros(1,14);...
    dummy(6,:);...
    zeros(1,13),1,zeros(1,12);...
    dummy(7,:);...
    zeros(1,15),1,zeros(1,10);...
    dummy(8,:);...
    zeros(1,17),1,zeros(1,8);...
    dummy(9,:);...
    zeros(1,19),1,zeros(1,6);...
    dummy(10,:);...
    zeros(1,21),1,zeros(1,4);...
    dummy(11,:);...
    zeros(1,23),1,zeros(1,2);...
    dummy(12,:);...
    zeros(1,25),1;...
    dummy(13,:)];
%%
dummy = M\DfxuDU1;
B1 = [zeros(1,4);...
    dummy(1,:);...
    zeros(1,4);...
    dummy(2,:);...
    zeros(1,4);...
    dummy(3,:);...
    zeros(1,4);...
    dummy(4,:);...
    zeros(1,4);...
    dummy(5,:);...
    zeros(1,4);...
    dummy(6,:);...
    zeros(1,4);...
    dummy(7,:);...
    zeros(1,4);...
    dummy(8,:);...
    zeros(1,4);...
    dummy(9,:);...
    zeros(1,4);...
    dummy(10,:);...
    zeros(1,4);...
    dummy(11,:);...
    zeros(1,4);...
    dummy(12,:);...
    zeros(1,4);...
    dummy(13,:)];
%%
dummy = M\DfxuDU2;
B2 = [zeros(1,4);...
    dummy(1,:);...
    zeros(1,4);...
    dummy(2,:);...
    zeros(1,4);...
    dummy(3,:);...
    zeros(1,4);...
    dummy(4,:);...
    zeros(1,4);...
    dummy(5,:);...
    zeros(1,4);...
    dummy(6,:);...
    zeros(1,4);...
    dummy(7,:);...
    zeros(1,4);...
    dummy(8,:);...
    zeros(1,4);...
    dummy(9,:);...
    zeros(1,4);...
    dummy(10,:);...
    zeros(1,4);...
    dummy(11,:);...
    zeros(1,4);...
    dummy(12,:);...
    zeros(1,4);...
    dummy(13,:)];
%%
dummy = M\DfxuDU;
B = [zeros(1,8);...
    dummy(1,:);...
    zeros(1,8);...
    dummy(2,:);...
    zeros(1,8);...
    dummy(3,:);...
    zeros(1,8);...
    dummy(4,:);...
    zeros(1,8);...
    dummy(5,:);...
    zeros(1,8);...
    dummy(6,:);...
    zeros(1,8);...
    dummy(7,:);...
    zeros(1,8);...
    dummy(8,:);...
    zeros(1,8);...
    dummy(9,:);...
    zeros(1,8);...
    dummy(10,:);...
    zeros(1,8);...
    dummy(11,:);...
    zeros(1,8);...
    dummy(12,:);...
    zeros(1,8);...
    dummy(13,:)];
%%
sys.A = A;
sys.B1 = B1;
sys.B2 = B2;
sys.B = B;
%%
sysd.A = eye(26) + A*dt;
sysd.B1 = B1*dt;
sysd.B2 = B2*dt;
sysd.B = B*dt;
end

